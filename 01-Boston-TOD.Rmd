---
title: "Transient Oriented Development in Boston"
author: "Emily Zhou"
date: "`r Sys.Date()`"
output:
  html_document:
    theme: flatly
    toc: true
    toc_float: true
    code_folding: hide
    code_download: true
editor_options:
  markdown:
    wrap: sentence
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Version 1.0 \| First Created Sep 15, 2023 \| Updated Sep 20, 2023
Key words: Multiple Ring Buffer, Indicators, Transit Oriented Development, Gentrification, Boston

# Introduction

In city planning, transit-oriented development (TOD) is a type of urban development practice that aims to maximize the amount of residential, business, and leisure space within walking distance of public transport. TOD offers a range of benefits that all contribute to creating a more vibrant, sustainable, and inclusive communities. For example, a community with a strong and dependable transit system and streetscaping elements can discourage vehicle dependence and congestion. This further leads to reduction in greenhouse gas emissions per capita and a smaller carbon footprint. In addition, as cities become more walkable, TOD can stimulate economic growth by attracting business and creating jobs. This includes bringing in mixed-use developments, such as retail, dining, and entertainment options within easy reach of resident. Moreover, TOD increases property values in surrounding areas. For developers and governments, this land value capitalization is particularly important. If renters and home buyers are willing to pay more to live near transit amenities, it should be reflected in higher land values and property tax returns near stations. 

Transit oriented development has been a large part of Bostonâ€™s growth. The Boston Redevelopment Authority has been undertaking a TOD initiative to build on and reinforce Boston's existing and emerging neighborhood centers. Their goal is to **connect all neighborhood centers into a comprehensive transit network** and to **support that network with appropriate development patterns near these neighborhood centers**. To contribute to this work, this report conducts a comprehensive analysis of existing TOD patterns in Boston. Through visualizing temporal changes in demographic, social, and economic characteristics of neighborhoods across Boston, examining the spatial distribution of transit stops, and comparing the differences of development patterns between TOD and Non-TOD tracts, we aim to address the following questions: 

1. Who is living around transit stations in Boston? 

2. How does the social, economic, and demographic characteristics of households living near transit stations in Boston change over time? 

3. Are Bostonians willing to pay a premium to live in transit-rich areas? If residents value these locations, officials should consider changing the zoning code to allow increased density around transit.

4. How can planners in Boston be more strategic about developments in transit-rich neighborhoods in order to satisfy the needs of those who favor transit proximity? 

5. What are the limitations of this methodology to predict transit-oriented development? 

The GitHub repository for this report is available [here](https://github.com/emilyzhou112/MUSA5080-Boston-TOD). 

# Packages and Dataset 


```{r setup_packages, warning = FALSE, eval = FALSE}

# list of required packages
packages <- c( "tidyverse", "ggplot2", "svDialogs", "tidycensus", "sf", "knitr", "rmarkdown", "kableExtra", "stringr", "biscale", "cowplot")

# install and load required packages
package.check <- lapply(
  packages,
  FUN = function(x) {
    if (!require(x, character.only = TRUE)) {
      install.packages(x, dependencies = TRUE, quietly=TRUE)
      library(x, character.only = TRUE)
    }
  }
)

# global options 
options(scipen=999)
options(tigris_class = "sf")
options(digits = 3)

# load in multiple ring buffer function
source("https://raw.githubusercontent.com/urbanSpatial/Public-Policy-Analytics-Landing/master/functions.r")

```


```{r load_key}

census_api_key(dlgInput(
  "Enter a Census API Key", # ask for an api key
  Sys.getenv("CENSUS_API_KEY")
)$res,
overwrite = TRUE)

```


```{r define_acs_var}

acs_var = c("B02001_001E", # total population
            "B02001_002E", # white population
            "B02001_003E", # black population
            "B02001_005E", # asian population
            "B03002_012E", # latinx population
            "B01001_022E", # male 70-74
            "B01001_023E", # male 75-79
            "B01001_024E", # male 80-85
            "B01001_025E", # male over 85
            "B01001_046E", # female 70-74
            "B01001_047E", # female 75-79
            "B01001_048E", # female 80-85
            "B01001_049E", # female over 85
            "B19013_001E", # median household income
            "B25058_001E", # median rent
            "B06012_002E", # total poverty
            "B06009_005E", # bachelor
            "B06009_006E", # graduate
            "B08014_002E", # no car
            "B25026_009E", # renter
            "B05001_006E" # non-us citizen
            )

```


```{r non_boston_county}

remove <- c("25025180400", "25025990101", "25025180301", "25025160400", "25025180500", "25025160601", "25025180200", "25025160300", "25025160200", "25025180101", "25025170502", "25025160502", "25025170701", "25025170501", "25025170800", "25025170200", "25025170400", "25025170100", "25025170100", "25025170601", "25025170300", "25025170702","25025160602", "25025160501", "25025160101")

```


```{r boston_2010_data}

boston10 <- 
  get_acs(geography = "tract", variables = acs_var, 
          year=2010, state='MA', county=025, geometry=T, output="wide") %>% 
  st_transform('EPSG:26986') %>% 
  filter(!(GEOID %in% remove)) %>% 
  rename(TotalPop = B02001_001E, 
         Whites = B02001_002E,
         African_Americans = B02001_003E,
         Asians = B02001_005E,
         Latinx = B03002_012E,
         M70_74 = B01001_022E,
         M75_79 = B01001_023E,
         M80_85 = B01001_024E,
         M85 = B01001_025E,
         FM70_74 = B01001_046E,
         FM75_79 = B01001_047E,
         FM80_85 = B01001_048E,
         FM85 = B01001_049E,
         MedHHInc = B19013_001E, 
         MedRent = B25058_001E,
         TotalPoverty = B06012_002E,
         College = B06009_005E,
         Graduate = B06009_006E,
         NoCar = B08014_002E,
         Renter = B25026_009E,
         Foreigner = B05001_006E
         ) %>% 
  dplyr::select(-starts_with("B"))%>%
  mutate(pctWhite = ifelse(TotalPop > 0, Whites / TotalPop, 0),
         pctMinority = ifelse(TotalPop > 0, (African_Americans + Asians + Latinx ) / TotalPop, 0),
         pctAging = ifelse(TotalPop > 0, (M70_74 + M75_79 + M80_85 + M85 + FM70_74 + FM75_79 + FM80_85 + FM85 ) / TotalPop, 0),
         pctBachelors = ifelse(TotalPop > 0, ((College + Graduate) / TotalPop), 0),
         pctPoverty = ifelse(TotalPop > 0, TotalPoverty / TotalPop, 0),
         pctNoCar = ifelse(TotalPop > 0, NoCar / TotalPop, 0),
         pctRenter = ifelse(TotalPop > 0, Renter / TotalPop, 0),
         pctForeigner = ifelse(TotalPop > 0, Foreigner / TotalPop, 0),
         year = "2010") %>% 
  dplyr::select(-Whites,-African_Americans, -Asians, -Latinx, -M70_74, -M75_79, -M80_85, -M85, -FM70_74, -FM75_79, -FM80_85, -FM85, -College, -Graduate, -TotalPoverty, -NoCar, -Renter, -Foreigner)

```


```{r boston_2019_data}

boston19 <- 
  get_acs(geography = "tract", variables = acs_var, 
          year=2019, state='MA', county=025, geometry=T, output="wide") %>% 
  st_transform('EPSG:26986') %>% 
  filter(!(GEOID %in% remove)) %>% 
  rename(TotalPop = B02001_001E, 
         Whites = B02001_002E,
         African_Americans = B02001_003E,
         Asians = B02001_005E,
         Latinx = B03002_012E,
         M70_74 = B01001_022E,
         M75_79 = B01001_023E,
         M80_85 = B01001_024E,
         M85 = B01001_025E,
         FM70_74 = B01001_046E,
         FM75_79 = B01001_047E,
         FM80_85 = B01001_048E,
         FM85 = B01001_049E,
         MedHHInc = B19013_001E, 
         MedRent = B25058_001E,
         TotalPoverty = B06012_002E,
         College = B06009_005E,
         Graduate = B06009_006E,
         NoCar = B08014_002E,
         Renter = B25026_009E,
         Foreigner = B05001_006E
         ) %>% 
  dplyr::select(-starts_with("B")) %>% 
    mutate(pctWhite = ifelse(TotalPop > 0, Whites / TotalPop, 0),
         pctMinority = ifelse(TotalPop > 0, (African_Americans + Asians + Latinx ) / TotalPop, 0),
         pctAging = ifelse(TotalPop > 0, (M70_74 + M75_79 + M80_85 + M85 + FM70_74 + FM75_79 + FM80_85 + FM85 ) / TotalPop, 0),
         pctBachelors = ifelse(TotalPop > 0, ((College + Graduate) / TotalPop), 0),
         pctPoverty = ifelse(TotalPop > 0, TotalPoverty / TotalPop, 0),
         pctNoCar = ifelse(TotalPop > 0, NoCar / TotalPop, 0),
         pctRenter = ifelse(TotalPop > 0, Renter / TotalPop, 0),
         pctForeigner = ifelse(TotalPop > 0, Foreigner / TotalPop, 0),
         year = "2019") %>% 
  dplyr::select(-Whites,-African_Americans, -Asians, -Latinx, -M70_74, -M75_79, -M80_85, -M85, -FM70_74, -FM75_79, -FM80_85, -FM85, -College, -Graduate, -TotalPoverty, -NoCar, -Renter, -Foreigner)

```

```{r combine_boston_data}

allTracts <- rbind(boston10,boston19)

```


```{r transit_data}

boston_stops <- st_read("https://raw.githubusercontent.com/emilyzhou112/MUSA5080-Boston-TOD/main/data/boston_stps.geojson") %>%
  st_transform(st_crs(boston10)) %>% 
  mutate(stops = ifelse(grepl("/", LINE), "OTHER", LINE)) 


```


```{r suffolk_county}

Suffolk <- 
  get_acs(geography = "tract", variables = "B02001_001E", 
          year=2010, state='MA', county=025, geometry=T, output="wide")

ggplot() + 
  geom_sf(data=st_union(Suffolk), fill= "#D3D3D3", color = "white", size = 2) +
  geom_sf(data=st_union(boston10), fill= "#bd7ebe", color = "white", size = 2) +
  labs(title = "Boston City in Suffolk County",
       caption = "Data: American Community Survey 2010 and 2019",
       color = "Boston") +
  theme_light() +
  theme(plot.title = element_text(size = 12, face = "bold")) +
  annotate(geom = "text",x = -71.10,y = 42.3, size = 4, label = "Boston",color = "white") +
  annotate(geom = "text",x = -71.04,y = 42.40, size = 3, label = "Chelsea",color = "black") +
  annotate(geom = "text",x = -71.01,y = 42.42, size = 3, label = "Revere",color = "black") +
  annotate(geom = "text",x = -70.97,y = 42.38, size = 3, label = "Winthrop",color = "black") 

```


```{r visualize_stops}

MBTA <- st_read("https://raw.githubusercontent.com/emilyzhou112/MUSA5080-Boston-TOD/main/data/MBTA_node.geojson") %>%
  st_transform(st_crs(boston10))

ggplot() + 
  geom_sf(data=st_union(boston10), fill= "#D3D3D3", color = "white", size = 2) +
  geom_sf(data=MBTA, color = "black", size= 1) + 
  geom_sf(data=boston_stops, 
          aes(colour = stops %>% str_to_title()),
          show.legend = "point", size= 1.5) + 
  scale_colour_manual(values = c("#7eb0d5","#b2e061", "#ffb55a", "#ffee65", "#fd7f6f", "#bd7ebe")) +
  labs(title = "Boston MBTA Rapid Transit Stops",
       caption = "Data: MassGIS 2022",
       colour = "Lines") +
  theme_light() +
  theme(plot.title = element_text(size = 12, face = "bold"))

```

```{r delineate_TOD}

stops_buffer <- st_union(st_buffer(boston_stops, 804)) %>% 
      st_sf() 

allTracts.group <- 
  rbind(
    st_centroid(allTracts)[stops_buffer,] %>%
      st_drop_geometry() %>%
      left_join(allTracts) %>%
      st_sf() %>%
      mutate(TOD = "TOD"),
    st_centroid(allTracts)[stops_buffer, op = st_disjoint] %>%
      st_drop_geometry() %>%
      left_join(allTracts) %>%
      st_sf() %>%
      mutate(TOD = "Non-TOD")) %>%
  mutate(MedRent.inf = ifelse(year == "2010", MedRent * 1.17, MedRent)) %>% 
  mutate(MedHHInc.inf = ifelse(year == "2010", MedHHInc * 1.17, MedHHInc)) 

```


```{r visualize_tod}

allTracts.group %>% 
  filter(year == 2010 ) %>% 
  ggplot() + 
  geom_sf(aes(fill = TOD), color = "transparent") +
  scale_fill_manual(values = c("#7eb0d5", "#b2e061")) + 
  geom_sf(data=boston_stops, 
          color = "#fd7f6f", size= 0.8)+
  labs(title = "Transient Oriented Development Tracts",
       subtitle = "Tracts within 0.5 mile of transit stops",
       caption = "Data: American Community Survey 2010 and 2019",
       fill = "Tracts Types") +
  theme_light() +   
  theme(plot.subtitle = element_text(size = 9,face = "italic"),
        plot.title = element_text(size = 12, face = "bold"))


```


## Demographic Characteristics 

```{r percentage_aging}

allTracts.group %>% 
  ggplot()+
  geom_sf(aes(fill=pctAging), color="transparent") +
  scale_fill_continuous(low = "#FAF9F6", high = "blue4", name= "Percentage Aging", breaks = c(0, 0.1, 0.2, 0.3))+
  facet_wrap(~year) +
  geom_sf(data=stops_buffer, color = "red", fill = "transparent", linewidth = 0.4) +
  theme(legend.position = "bottom",
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank(),
        plot.subtitle = element_text(size = 9,face = "italic"),
        plot.title = element_text(size = 12, face = "bold"),
        panel.background = element_blank(),
        panel.border = element_rect(colour = "grey", fill=NA, size=0.8)
        ) + 
  labs(title = "Percentage of Aging Population in Boston",
       subtitle = "Red circles indicate areas within 0.5 mile of a transit stops",
       caption = "Data: American Community Survey 2010 and 2019 \n MassGIS 2022") 
 

```


```{r percent_foreigner}

allTracts.group %>% 
  ggplot()+
  geom_sf(aes(fill=pctForeigner), color="transparent") +
  scale_fill_continuous(low = "#FAF9F6", high = "blue4", name= "Percentage Foreigner", breaks = c(0, 0.2, 0.4, 0.6))+
  facet_wrap(~year) +
  geom_sf(data=stops_buffer, color = "red", fill = "transparent", linewidth = 0.4) +
 theme(legend.position = "bottom",
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank(),
        plot.subtitle = element_text(size = 9,face = "italic"),
        plot.title = element_text(size = 12, face = "bold"),
        panel.background = element_blank(),
        panel.border = element_rect(colour = "grey", fill=NA, size=0.8)
        ) + 
  labs(title = "Percentage of Non-US Citizens in Boston",
       subtitle = "Red circles indicate areas within 0.5 mile of a transit stops",
       caption = "Data: American Community Survey 2010 and 2019 \n MassGIS 2022") 
 
```

```{r percent_minorities}
allTracts.group %>% 
  ggplot()+
  geom_sf(aes(fill=pctMinority), color="transparent") +
  scale_fill_continuous(low = "#FAF9F6", high = "blue4", name= "Percentage Minority", breaks = c(0, 0.3, 0.6, 0.9))+
  facet_wrap(~year) +
  geom_sf(data=stops_buffer, color = "red", fill = "transparent", linewidth = 0.4) +
 theme(legend.position = "bottom",
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank(),
        plot.subtitle = element_text(size = 9,face = "italic"),
        plot.title = element_text(size = 12, face = "bold"),
        panel.background = element_blank(),
        panel.border = element_rect(colour = "grey", fill=NA, size=0.8)
        ) + 
  labs(title = "Percentage of Minorities in Boston",
       subtitle = "Red circles indicate areas within 0.5 mile of a transit stops",
       caption = "Data: American Community Survey 2010 and 2019 \n MassGIS 2022") 
```


## Economic Characteristics

```{r median_rent}

allTracts.group %>% 
  ggplot()+
  geom_sf(aes(fill=MedRent.inf), color="transparent") +
  scale_fill_continuous(low = "#FAF9F6", high = "seagreen4", name= "Rent")+
  facet_wrap(~year) +
  geom_sf(data=stops_buffer, color = "red", fill = "transparent", linewidth = 0.4) +
   theme(legend.position = "bottom",
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank(),
        plot.subtitle = element_text(size = 9,face = "italic"),
        plot.title = element_text(size = 12, face = "bold"),
        panel.background = element_blank(),
        panel.border = element_rect(colour = "grey", fill=NA, size=0.8)
        ) + 
  labs(title = "Median Rent in Boston",
       subtitle = "Red circles indicate areas within 0.5 mile of a transit stops \n2019 data adjusted for inflation",
       caption = "Data: American Community Survey 2010 and 2019 \n MassGIS 2022") 

```
```{r poverty}

allTracts.group %>% 
  ggplot()+
  geom_sf(aes(fill=pctPoverty), color="transparent") +
  scale_fill_continuous(low = "#FAF9F6", high = "seagreen4", name= "Percentage Poverty")+
  facet_wrap(~year) +
  geom_sf(data=stops_buffer, color = "red", fill = "transparent", linewidth = 0.4) +
 theme(legend.position = "bottom",
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank(),
        plot.subtitle = element_text(size = 9,face = "italic"),
        plot.title = element_text(size = 12, face = "bold"),
        panel.background = element_blank(),
        panel.border = element_rect(colour = "grey", fill=NA, size=0.8)
        ) + 
  labs(title = "Percentage Poverty in Boston",
       subtitle = "Red circles indicate areas within 0.5 mile of a transit stops",
       caption = "Data: American Community Survey 2010 and 2019 \n MassGIS 2022")

```


```{r}

allTracts.group %>% 
  mutate(inc = MedHHInc.inf/1000) %>% 
  ggplot()+
  geom_sf(aes(fill=inc), color="transparent") +
  scale_fill_continuous(low = "#FAF9F6", high = "seagreen4", name= "Income (thousands)")+
  facet_wrap(~year) +
  geom_sf(data=stops_buffer, color = "red", fill = "transparent", linewidth = 0.4) +
  theme(legend.position = "bottom",
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank(),
        plot.subtitle = element_text(size = 9,face = "italic"),
        plot.title = element_text(size = 12, face = "bold"),
        panel.background = element_blank(),
        panel.border = element_rect(colour = "grey", fill=NA, size=0.8)
        ) + 
  labs(title = "Median Household Income in Boston",
       subtitle = "Red circles indicate areas within 0.5 mile of a transit stops\n2019 data adjusted for inflation",
       caption = "Data: American Community Survey 2010 and 2019 \n MassGIS 2022")

```



## Social Characteristics 

```{r renters}

allTracts.group %>% 
  ggplot()+
  geom_sf(aes(fill=pctRenter), color="transparent") +
  scale_fill_continuous(low = "#FAF9F6", high = "#0047AB", name= "Percentage Renters")+
  facet_wrap(~year) +
  geom_sf(data=stops_buffer, color = "red", fill = "transparent", linewidth = 0.4) +
   theme(legend.position = "bottom",
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank(),
        plot.subtitle = element_text(size = 9,face = "italic"),
        plot.title = element_text(size = 12, face = "bold"),
        panel.background = element_blank(),
        panel.border = element_rect(colour = "grey", fill=NA, size=0.8)
        ) + 
  labs(title = "Percentage Renters in Boston",
       subtitle = "Red circles indicate areas within 0.5 mile of a transit stops",
       caption = "Data: American Community Survey 2010 and 2019 \n MassGIS 2022") 

```


```{r no car}

allTracts.group %>% 
  ggplot()+
  geom_sf(aes(fill=pctNoCar), color="transparent") +
  scale_fill_continuous(low = "#FAF9F6", high = "#0047AB", name= "Percentage No Vehicle", breaks = c(0, 0.2, 0.4, 0.6))+
  facet_wrap(~year) +
  geom_sf(data=stops_buffer, color = "red", fill = "transparent", linewidth = 0.4) +
   theme(legend.position = "bottom",
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank(),
        plot.subtitle = element_text(size = 9,face = "italic"),
        plot.title = element_text(size = 12, face = "bold"),
        panel.background = element_blank(),
        panel.border = element_rect(colour = "grey", fill=NA, size=0.8)
        ) + 
  labs(title = "Percentage of Population without Car in Boston",
       subtitle = "Red circles indicate areas within 0.5 mile of a transit stops",
       caption = "Data: American Community Survey 2010 and 2019 \n MassGIS 2022") 


```

```{r}
allTracts.group %>% 
  ggplot()+
  geom_sf(aes(fill=pctBachelors), color="transparent") +
  scale_fill_continuous(low = "#FAF9F6", high = "#0047AB", name= "Percentage Bachelors", breaks = c(0, 0.3, 0.6, 0.9))+
  facet_wrap(~year) +
  geom_sf(data=stops_buffer, color = "red", fill = "transparent", linewidth = 0.4) +
   theme(legend.position = "bottom",
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank(),
        plot.subtitle = element_text(size = 9,face = "italic"),
        plot.title = element_text(size = 12, face = "bold"),
        panel.background = element_blank(),
        panel.border = element_rect(colour = "grey", fill=NA, size=0.8)
        ) + 
  labs(title = "Percentage of Population with at Least a Bacehlor's Degree in Boston",
       subtitle = "Red circles indicate areas within 0.5 mile of a transit stops",
       caption = "Data: American Community Survey 2010 and 2019 \n MassGIS 2022") 

```

## Overall Analysis 

```{r all_variables_summarize}

allTracts.Summary <- 
  st_drop_geometry(allTracts.group) %>%
  group_by(year, TOD) %>%
  summarize(Rent = mean(MedRent.inf, na.rm = T),
            Income = mean(MedHHInc.inf, na.rm = T),
            Pop = mean(TotalPop, na.rm = T),
            PctMinority = mean(pctMinority, na.rm = T),
            PctAging = mean(pctAging, na.rm = T),
            PctBach = mean(pctBachelors, na.rm = T),
            PctPoverty = mean(pctPoverty, na.rm = T),
            PctNoCar = mean(pctNoCar, na.rm = T),
            PctRenter = mean(pctRenter, na.rm = T),
            PctForeign = mean(pctForeigner, na.rm = T))

```


```{r all_variables_table}

kable(allTracts.Summary, format = "html") %>%
 kable_styling(full_width = T, 
               bootstrap_options = c("striped", "hover"),
               font_size = 12) %>% 
  footnote(general_title = "\n",
           general = "Table 1: Comparaing Population Characteristics Across Space and Time ") %>% 
  row_spec(0, font_size = 14) %>% 
  row_spec(1, color = "white", background = "#7eb0d5") %>% 
  row_spec(2, color = "white", background = "#b2e061") %>% 
  row_spec(3, color = "white", background = "#7eb0d5") %>% 
  row_spec(4, color = "white", background = "#b2e061") %>% 
  column_spec(1:2, bold = T)

# 

```


```{r all_variables_plot}

allTracts.Summary %>%
  gather(Variable, Value, -year, -TOD) %>%
  ggplot(aes(year, Value, fill = TOD)) +
  geom_bar(stat = "identity", position = "dodge") +
  facet_wrap(~Variable, scales = "free", ncol=5) +
  scale_fill_manual(values = c("#7eb0d5", "#b2e061")) +  
  labs(title = "Indicator Differences Across Time and Space",
       caption = "Data: American Community Survey 2010 and 2019") +
  theme(legend.position = "bottom",
        axis.ticks.x=element_blank(),
        axis.ticks.y=element_blank(),
        plot.title = element_text(size = 12, face = "bold"),
        panel.background = element_blank(),
        panel.border = element_rect(colour = "grey", fill=NA, size=0.8)
        ) 
```



```{r percentage_change}

allTracts.Long <- allTracts.Summary %>%
  pivot_longer(cols = c(Rent, Income, Pop, PctMinority, PctAging, PctBach, PctPoverty, PctNoCar, PctRenter, PctForeign), names_to = "Variable", values_to = "Value") %>%
  pivot_wider(names_from = year, values_from = Value, names_prefix = "Year") %>% 
  mutate(pct_change = (Year2019-Year2010) / Year2010)

```


```{r all_variables_bar}

allTracts.Long %>% 
  ggplot() +
  geom_bar(aes(x = Variable, y = pct_change, fill = TOD),
           stat = "identity") +
  facet_wrap(~TOD) +
  coord_flip() +
  scale_fill_manual(values = c("#7eb0d5", "#b2e061")) +  
  labs(title = "Percentage Change 2010-2019 for TOD and Non-TOD Tracks",
       caption = "Data: American Community Survey 2010 and 2019") +
  ylab ("Percentage Change") +
  theme(legend.position = "bottom",
        axis.ticks.x=element_blank(),
        axis.ticks.y=element_blank(),
        plot.title = element_text(size = 12, face = "bold"),
        panel.background = element_blank(),
        panel.border = element_rect(colour = "grey", fill=NA, size=0.8)
        ) 
  


```

Observations: 
- Rent in Boston has been increasing, but the increase in TOD is more salient. 
- Population in Boston has been increasing, but the increase in non-TOD is more salient
- Renters stay pretty much the same throughout. 
- Poverty rate greatly reduced, especially in TOD areas. 
- More people in Non-TOD tracks do not have car. 
- More minority population starts to live in TOD areas. 
- Education attainment in Boston greatly increase in both TOD and non-TOD. 
- Percentage Aging population starts to live in TOD.
- Income increases in both TOD and non-TOD. 

## Further Analysis 

```{r graduated_prep}

boston_stops$ID <- seq_along(boston_stops$STATION)

stop_attributes <- st_buffer(boston_stops, 804) %>% 
  st_sf() %>% 
  st_intersection(st_centroid(boston10)) %>% 
  st_drop_geometry() %>% 
  group_by(ID) %>% 
  summarize(
    total_population = sum(TotalPop),
    median_rent = mean(MedRent, na.rm = T))

stops_summary <- boston_stops %>% 
  left_join(stop_attributes, by = "ID")

```

```{r graduated_pop, warning=FALSE}

ggplot() +
  geom_sf(data=st_union(boston10), fill= "#D3D3D3", color = "white", size = 2) +
  geom_sf(data=stops_summary, aes(size=total_population, color = stops %>% str_to_title())) +
  scale_size(range = c(0.5, 3), name = "Population") +    
  scale_colour_manual(values = c("#7eb0d5","#b2e061", "#ffb55a", "#ffee65", "#fd7f6f", "#bd7ebe"), name = "Stops") +
  labs(title = "Population within 0.5 Mile of Tansit Stops",
       subtitle = "Dot size proportional to population",
       caption = "Data: American Community Survey 2010 and 2019") +
  theme_light() +   
  theme(plot.subtitle = element_text(size = 9,face = "italic"),
        plot.title = element_text(size = 12, face = "bold"))
```

```{r graduated_rent, warning=FALSE}


ggplot() +
  geom_sf(data=st_union(boston10), fill= "#D3D3D3", color = "white", size = 2) +
  geom_sf(data=stops_summary, aes(size=median_rent, color = stops %>% str_to_title())) +
  scale_size(range = c(0.5, 3), name = "Rent") +    
  scale_colour_manual(values = c("#7eb0d5","#b2e061", "#ffb55a", "#ffee65", "#fd7f6f", "#bd7ebe"), name = "Stops") +
  labs(title = "Median Rent within 0.5 Mile of Tansit Stops",
       subtitle = "Dot size proportional to rent",
       caption = "Data: American Community Survey 2010 and 2019") +
  theme_light() +   
  theme(plot.subtitle = element_text(size = 9,face = "italic"),
        plot.title = element_text(size = 12, face = "bold"))
```

```{r boston_MRB}

boston_MRB <- multipleRingBuffer(st_union(boston_stops), 14484, 804)
ggplot() +
    geom_sf(data=boston_MRB, aes(fill = distance), color = "#708090") +
    scale_fill_continuous(low = "#FAF9F6", high = "#beb9db", name= "Distance")+
    geom_sf(data=st_union(boston10), fill= "#D3D3D3", color = "white", size = 2) +
    geom_sf(data=boston_stops, 
          color = "#fd7f6f", size= 0.8) +    
    labs(title="Half Mile Buffers",
         subtitle = "Distance in-between each buffer is 0.5 mile",
         caption = "Data: American Community Survey 2010 and 2019 \nMassGIS 2022") +
    theme_light() +   
    theme(plot.subtitle = element_text(size = 9,face = "italic"),
          plot.title = element_text(size = 12, face = "bold"))

```

```{r line_plot}

allTracts.rings <-
  st_join(st_centroid(dplyr::select(allTracts, GEOID, year)),
          boston_MRB) %>%
  st_drop_geometry() %>%
  left_join(dplyr::select(allTracts, GEOID, MedRent, year), 
            by=c("GEOID"="GEOID", "year"="year")) %>%
  st_sf() 


allTracts.rings.summary <- st_drop_geometry(allTracts.rings) %>%
  group_by(distance, year) %>%
  summarize(Mean_Rent = mean(MedRent, na.rm=T))


ggplot(allTracts.rings.summary, aes(x = distance, y = Mean_Rent)) + 
  geom_line(aes(color = year), size = 2) + 
  scale_color_manual(values = c("#7eb0d5", "#b2e061"), name = "Year") +
  labs(title = "Mean Rent as a Function of Distance to Subway Stations",
       caption = "Data: American Community Survey 2010 and 2019") +
  xlab ("Distance from Transit Stops") +
  ylab("Mean Rent") + 
  theme(legend.position = "bottom",
        plot.title = element_text(size = 12, face = "bold"),
        panel.background = element_blank(),
        panel.border = element_rect(colour = "grey", fill=NA, size=0.8)
        ) 

```

## Bivariate informing planning decisions 


```{r bivariate_map}


bi_data <- bi_class(boston19, x = pctMinority, y = pctAging, style = "quantile", dim = 3) #  a 3*3 color-schemed bi-variate choropleth 

bi_map <- ggplot() +
  geom_sf(data = bi_data, mapping = aes(fill = bi_class), color = "transparent", show.legend = FALSE) +
  bi_scale_fill(pal = "DkCyan", dim = 3) + 
  labs(title = "Pct Minority, Pct Aging Population") + 
  geom_sf(data = boston_stops, colour = "red", alpha = 0.8, size = 0.5) +
  theme_light() +
  theme(plot.title = element_text(size = 12, face = "bold"))

legend <- bi_legend(pal = "DkCyan",
                    dim = 3,
                    xlab = "PctMinority ",
                    ylab = "PctAging ",
                    size = 5.8)
  
ggdraw() +
  draw_plot(bi_map, 0, 0, 1, 1) +
  draw_plot(legend, 0.1, 0.1, 1.2, 0.23)
```







